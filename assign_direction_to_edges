
CREATE TABLE linkuse_direction AS(
        SELECT
        *,
        degrees(ST_Azimuth(origin, destination)) AS az
    FROM (
        SELECT 
            edge,
            total,
            ST_AsText(geom) AS fullwkt,
            ST_PointN((q.geodump).geom, 1) AS origin,
            ST_PointN((q.geodump).geom, ST_NumPoints((q.geodump).geom)) AS destination
        FROM (
            SELECT 
                *,
                ST_Dump(geom) AS geodump
            FROM linkuse_lts
        ) AS q
    ) AS qq
);
COMMIT;


-- add field to hold cardinal direction
ALTER TABLE linkuse_direction
ADD COLUMN direction TYPE varchar(5)


-- update and run for each cardinal direction used
UPDATE linkuse_direction
SET direction = 'W'
WHERE az <= 337.5 AND az > 292.5;


-- write resulting table to csv
COPY linkuse_direction TO 'D:\Modeling\BikeStress\linkuse_direction.csv' DELIMITER ',' CSV HEADER;